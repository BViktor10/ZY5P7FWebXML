\documentclass[12pt, a4paper]{article}

% Szükséges csomagok betöltése
\usepackage[utf8]{inputenc}
\usepackage[magyar]{babel}
\usepackage{t1enc}
\usepackage{geometry}
\usepackage{graphicx}
\usepackage{setspace} % 1.5 sorközhöz
\usepackage{titlesec} % Címsorok formázásához
\usepackage{hyperref} % Hiperhivatkozásokhoz
\usepackage{listings} % Kódok beillesztéséhez
\usepackage{xcolor}
\usepackage{caption}

% Margók beállítása (általános A4 szabvány)
\geometry{left=2.5cm, right=2.5cm, top=2.5cm, bottom=2.5cm}

% 1.5-ös sorköz beállítása [cite: 54]
\onehalfspacing

% Betűtípus beállítása (Times New Roman-szerű) [cite: 51]
\usepackage{mathptmx}

% Kódblokkok formázása [cite: 56]
\lstset{
    basicstyle=\ttfamily\footnotesize,
    keywordstyle=\color{blue}\bfseries,
    commentstyle=\color{green!50!black},
    stringstyle=\color{red},
    showstringspaces=false,
    breaklines=true,
    frame=single,
    tabsize=4,
    inputencoding=utf8,
    extendedchars=true,
    literate={á}{{\'a}}1 {é}{{\'e}}1 {í}{{\'i}}1 {ó}{{\'o}}1 {ö}{{\"o}}1 {ő}{{\H{o}}}1 {ú}{{\'u}}1 {ü}{{\"u}}1 {ű}{{\H{u}}}1
             {Á}{{\'A}}1 {É}{{\'E}}1 {Í}{{\'I}}1 {Ó}{{\'O}}1 {Ö}{{\"O}}1 {Ő}{{\H{O}}}1 {Ú}{{\'U}}1 {Ü}{{\"U}}1 {Ű}{{\H{U}}}1
}

% Címsorok formázása a követelmények szerint [cite: 53]
\titleformat{\section}{\normalfont\fontsize{14}{17}\bfseries}{\thesection}{1em}{}
\titleformat{\subsection}{\normalfont\fontsize{12}{15}\bfseries}{\thesubsection}{1em}{}

\begin{document}

% --- CÍMLAP KEZDETE [cite: 1-8] ---
\begin{titlepage}
    \centering
    \vspace*{1cm}
    
    {\fontsize{24}{28}\bfseries JEGYZŐKÖNYV \par}
    \vspace{1.5cm}
    
    {\fontsize{16}{20}\bfseries Webes adatkezelő környezetek \par}
    \vspace{0.5cm}
    {\Large Féléves feladat \par}
    
    \vspace{3cm}
    
    % A feladat címe (kitaláltuk)
    {\fontsize{20}{24}\bfseries Pszichiátria Nyilvántartó Rendszer \par}
    
    \vspace{10cm}
    
    \begin{flushright}
        \textbf{Készítette:} Berki Viktor \\
        \textbf{Neptunkód:} ZY5P7F \\
        \textbf{Dátum:} 2025. december 1.
    \end{flushright}
    
    \vfill
    
    {\large Miskolc, 2025 \par}
\end{titlepage}
% --- CÍMLAP VÉGE ---

% Tartalomjegyzék (automatikusan generált és hiperhivatkozott) [cite: 9]
\tableofcontents
\newpage

% --- 1. FELADAT ---

\section*{Bevezetés}
A féléves feladat során egy pszichiátriai osztály nyilvántartó rendszerét valósítottam meg. A rendszer célja az osztályok, orvosok, páciensek, a hozzájuk tartozó kórlapok és a felírt gyógyszerek adatainak strukturált tárolása és kezelése XML alapokon. [cite: 10]

\section{XML alapú adatkezelés tervezése és megvalósítása}

\subsection{Az adatbázis ER modell tervezése}
A tervezés során öt egyedet definiáltam: \textbf{Ward} (Osztály), \textbf{Psychiatrist} (Pszichiáter), \textbf{Patient} (Páciens), \textbf{MedicalRecord} (Kórlap) és \textbf{Medication} (Gyógyszer).

A kapcsolatok a következők:
\begin{itemize}
    \item \textbf{1:N kapcsolat:} Egy osztályon több orvos dolgozik, egy orvos több beteget kezel.
    \item \textbf{1:1 kapcsolat:} Egy betegnek pontosan egy kórlapja van.
    \item \textbf{M:N kapcsolat:} A betegek és gyógyszerek között (a beteg szedi a gyógyszert), melyet a \textit{Takes} kapcsolat valósít meg \textit{DailyDosage} tulajdonsággal.
\end{itemize}
Az egyedek rendelkeznek kulcsokkal (PK), összetett (pl. Lakcím, Név) és többértékű (pl. Telefonszám) tulajdonságokkal is. [cite: 15]

\begin{figure}[h!]
    \centering
    \includegraphics[width=0.9\textwidth]{ZY5P7F_ER.png}
    \caption{A rendszer ER modellje}
    \label{fig:er_model}
\end{figure}

\newpage
\subsection{Az adatbázis konvertálása XDM modellre}
Az ER modellt hierarchikus XDM modellé alakítottam át. A "vonalak ne keresztezzék egymást" szabály betartása érdekében a \textbf{Medications} listát külön ágon, törzsadatként kezelem. A hierarchia jobb oldala a \textbf{Ward} $\rightarrow$ \textbf{Psychiatrist} $\rightarrow$ \textbf{Patient} láncolatot követi. A \textbf{MedicalRecord} a páciensbe ágyazódik be. Az M:N kapcsolatot a \textbf{Prescription} elem oldja meg, amely IDREF attribútummal mutat a bal oldali gyógyszer listára. [cite: 17, 19]

\begin{figure}[h!]
    \centering
    \includegraphics[width=0.9\textwidth]{ZY5P7F_XDM.png}
    \caption{A rendszer XDM modellje}
    \label{fig:xdm_model}
\end{figure}

\subsection{Az XDM modell alapján XML dokumentum készítése}
Az XML dokumentum a `PsychiatrySystem` gyökérelem alatt tárolja az adatokat. Minden többszörösen előforduló elemből (pl. Ward, Psychiatrist, Medication) legalább két példány készült. A dokumentum tartalmazza a szükséges attribútumokat (id, ref) és a kommenteket. [cite: 21, 22]

\textbf{Fájlnév:} \texttt{ZY5P7F\_XML.xml}

\begin{lstlisting}[language=XML, caption=Részlet a lapos szerkezetű XML fájlból]
<PsychiatrySystem>
    <Wards>
        <Ward id="W01">
            <Name>Acute Care Unit</Name>
            </Ward>
    </Wards>
    <Psychiatrists>
        <Psychiatrist license="LIC-12345" wardRef="W01">
            <Name>...</Name>
        </Psychiatrist>
    </Psychiatrists>
    <Patients>
        <Patient ssn="111-22-3333" doctorRef="LIC-12345">
            <Name>John Doe</Name>
        </Patient>
    </Patients>
</PsychiatrySystem>
\end{lstlisting}

\subsection{Az XML dokumentum alapján XMLSchema készítése}
Az XSD sémában saját egyszerű és összetett típusokat definiáltam (pl. \texttt{SSNType}, \texttt{AddressType}). A kapcsolati integritást \texttt{xs:key} és \texttt{xs:keyref} elemekkel biztosítottam, így a receptek csak létező gyógyszer ID-ra hivatkozhatnak. [cite: 24, 25, 26]

\textbf{Fájlnév:} \texttt{ZY5P7F\_XMLSchema.xsd}

\begin{lstlisting}[language=XML, caption=Részlet az XSD sémából (Kulcsok és Unique)]
<xs:keyref name="DoctorToWard" refer="WardKey">
    <xs:selector xpath="Psychiatrists/Psychiatrist"/>
    <xs:field xpath="@wardRef"/>
</xs:keyref>

<xs:unique name="UniqueRecordPerPatient">
    <xs:selector xpath="MedicalRecords/MedicalRecord"/>
    <xs:field xpath="@patientRef"/>
</xs:unique>
\end{lstlisting}
% --- 2. FELADAT ---

\section{DOM program készítése}

A feladat második részében egy Java alkalmazást készítettem, amely DOM (Document Object Model) segítségével dolgozza fel az XML állományt.

\textbf{Projekt adatok:} [cite: 30, 31, 32]
\begin{itemize}
    \item \textbf{Project name:} ZY5P7FDOMParse
    \item \textbf{Package:} zy5p7f.domparse.hu
    \item \textbf{Class names:} ZY5P7FDomRead, ZY5P7FDomQuery, ZY5P7FDomModify
    \item \textbf{XML name:} ZY5P7F\_XML.xml
\end{itemize}

\subsection{Adatolvasás}
A \texttt{ZY5P7FDomRead} osztály beolvassa a teljes XML dokumentumot a memóriába, majd egy rekurzív metódus segítségével végigjárja a DOM fát. A program blokkos formában írja ki a konzolra az elemeket, attribútumokat és a szöveges tartalmakat. [cite: 33, 37]

\begin{lstlisting}[language=Java, caption=Részlet az Adatolvasás kódból]
// Rekurzív metódus a fa bejárására
private static void printNode(Node node, String indent) {
    if (node.getNodeType() == Node.ELEMENT_NODE) {
        System.out.print(indent + "Elem: " + node.getNodeName());
        
        // Attribútumok kiírása
        if (node.hasAttributes()) {
            NamedNodeMap nodeMap = node.getAttributes();
            for (int i = 0; i < nodeMap.getLength(); i++) {
                Node tempNode = nodeMap.item(i);
                System.out.print(" | " + tempNode.getNodeName() + "=" + tempNode.getNodeValue());
            }
        }
        // ... (további logika)
    }
}
\end{lstlisting}

\subsection{Adat-lekérdezés}
A \texttt{ZY5P7FDomQuery} osztályban \textbf{4 különböző lekérdezést} valósítottam meg a feladatkiírásnak megfelelően. A lekérdezések során a lapos szerkezet miatt az elemeket az azonosítóik (ID) és hivatkozásaik (Ref) alapján kellett összekapcsolni.

\textbf{A megvalósított lekérdezések:}
\begin{enumerate}
    \item Osztályok neveinek listázása.
    \item Adott osztályon ("Acute Care Unit") dolgozó orvosok lekérdezése (FK kapcsolat).
    \item Adott beteg ("John Doe") diagnózisának lekérdezése (1:1 kapcsolat).
    \item Gyógyszerek számának aggregálása.
\end{enumerate}

\begin{lstlisting}[language=Java, caption=Részlet: Orvosok keresése osztály alapján]
// Megkeressük azokat az orvosokat, akiknek a wardRef attribútuma egyezik
NodeList docList = doc.getElementsByTagName("Psychiatrist");
for (int i = 0; i < docList.getLength(); i++) {
    Element doctor = (Element) docList.item(i);
    if (doctor.getAttribute("wardRef").equals(wardId)) {
        // ... Orvos nevének kiírása ...
    }
}
\end{lstlisting}

\subsection{Adatmódosítás}
A \texttt{ZY5P7FDomModify} osztályban \textbf{4 különböző módosítást} végeztem el az XML adatain. A program a módosítások után a frissített DOM fát elmenti egy \texttt{ZY5P7F\_XML\_Modified.xml} nevű fájlba.

\textbf{A végrehajtott módosítások:}
\begin{enumerate}
    \item Gyógyszer átnevezése ("Xanax" $\rightarrow$ "Xanax SR").
    \item Ágyszám növelése egy osztályon.
    \item Beteg lakcímének (Város) javítása.
    \item Orvos email címének frissítése.
\end{enumerate}

\begin{lstlisting}[language=Java, caption=Részlet: Több módosítás végrehajtása]
// 1. Gyógyszer átnevezése
if ("MED001".equals(med.getAttribute("id"))) {
    brand.setTextContent("Xanax SR");
}
// ...
// 2. Ágyszám növelése
if ("W01".equals(ward.getAttribute("id"))) {
    beds.setTextContent("35");
}
// Mentés fájlba...
\end{lstlisting}

\end{document}
